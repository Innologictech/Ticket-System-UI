<div class="card" *ngIf="this.loginData?.data.employeeActivity == 'TEAM LEAD'">
  <div class="card-header">
      Awating Verification
  </div>
  <div class="card-body">  
    <div class="table-responsive tableFixHead">
      <table class="table table-bordered ">
        <thead class="thead-light">
          <tr>
            <th class="text-nowrap">Employee ID</th>
            <th class="text-nowrap">Employee Name</th>
            <th class="text-nowrap">Year</th>
            <th class="text-nowrap">Month</th>
            <th class="text-nowrap">Week Number</th>
            <th class="text-nowrap">Week Total Hours</th>
             <th class="text-nowrap">Week Data</th>
            <th class="text-nowrap">Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let timesheet of reviewedSheets">
            <td class="text-nowrap">{{ timesheet.employeeId }}</td>
            <td class="text-nowrap">{{ timesheet.employeeName }}</td>
            <td class="text-nowrap">{{ timesheet.year }}</td>
            <td class="text-nowrap">{{ timesheet.month }}</td>
            <td class="text-nowrap">{{ timesheet.weekNumber }}</td>
            <td class="text-nowrap">{{ timesheet.weekHoursTotal | number: '1.2-2' }}</td>
            <td>
              <i class="fa fa-eye" role="button" (click)="openEntriesModal(timesheet.entries)"></i>
                        </td>
            <td class="text-nowrap">{{ timesheet.isStatusVerifyed }}</td>
            <td>
              <button *ngIf="timesheet.isStatusVerifyed == ''" class="btn btn-success btn-sm" (click)="openVerifyedDialog(timesheet)">Verified</button>
            </td>
                </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<ng-template #entriesModal let-modal>
  
  <div class="modal-header">
    <h5 class="modal-title">
      Weeks Data List
    </h5>
    <button type="button" class="close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
   <div class="modal-body">
    <div class="table">
      <table class="table table-bordered table-striped">
        <thead class="thead-light">
          <tr>
            <th>Date</th>
            <th>Day</th>
            <th>Task</th>
            <th>Project</th>
            <th>Hours</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let entry of selectedEntries">
            <td>{{ entry.date | date }}</td>
            <td>{{ entry.day }}</td>
            <td>{{ entry.task }}</td>
            <td>{{ entry.project }}</td>
            <td>{{ entry.hours }}</td>
          </tr>
        </tbody>
      </table>
    </div>
   </div>
  
</ng-template>





<ng-template #verifiedModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      Reason
    </h5>
    <button type="button" class="close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   <form>
    <div class="form-group">
      <label for="approvalRemark">
        Remark
      </label>
      <textarea 
        id="approvalRemark"
        class="form-control" 
        [(ngModel)]="isVerifyedreason"
        rows="3"
        placeholder="Enter Reason">
      </textarea>
     
    </div>
   </form>
  </div>
  <div class="modal-footer">
    <button 
      type="button"  class="btn btnSubmit btn-raised btn-md" (click)="verifyedSubmit()"
    >
      Submit
    </button>
    <button type="button" class="btn btnCancel btn-md btn-raised"style="background-color: red;" (click)="modal.dismiss()">Cancel</button>

  </div>
</ng-template>


  <div class="row" *ngIf="this.loginData?.data.employeeActivity == 'MD' || this.loginData?.data.employeeActivity == 'ADMIN' || this.loginData?.data.employeeActivity == 'MANAGER'">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          Review List
      </div>
        <div class="card-body">
          <div id="basic-example">
            <ng-stepper #cdkStepper [linear]="true" class="wizard">
           
              <cdk-step [optional]="false">
                <ng-template cdkStepLabel>
                  <span class="number">1.</span>
                  <span>Past</span>
                </ng-template>
                <section>

                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th>Expand</th>
                        <th>Team Lead ID</th>
                        
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngFor="let teamLeadId of teamLeadIds">
                        <tr (click)="toggleExpand(teamLeadId)" style="cursor: pointer;">
                          <td>
                            <i class="fas" [ngClass]="expandedLeadId === teamLeadId ? 'fa-chevron-up' : 'fa-chevron-right'"></i>
                          </td>
                          <td>{{ teamLeadNamesMap[teamLeadId] }} - {{ teamLeadId }}</td>

                        </tr>
                  
                        <tr *ngIf="expandedLeadId === teamLeadId">
                          <td colspan="2">
                            <table class="table table-sm table-striped">
                              <thead>
                                <tr>
                                  <th>Employee ID</th>
                                  <th>Employee Name</th>
                                  <th>Year</th>
                                  <th>Month</th>
                                  <th>Week Number</th>
                                  <th>Total Hours</th>
                                  <th>Week Data</th>
                                  <th>Status</th>
                                  <th>Action</th>
                                  
                                </tr>
                              </thead>
                              <tbody>
                                <tr *ngFor="let entry of reviewedData[teamLeadId]">
                                  <td>{{ entry.employeeId }}</td>
                                  <td>{{entry.employeeName}}</td>
                                  <td>{{entry.year}}</td>
                                  <td>{{ entry.month }}</td>
                                  <td>{{ entry.weekNumber }}</td>
                                  <td>{{ entry.weekHoursTotal }}</td>
                                  <td>
                                    <!-- <i class="fa fa-eye" role="button" (click)="openEntriesModal(entry)"></i> -->
                                    <i class="fa fa-eye text-primary" role="button" style="cursor: pointer;"
                                    title="View week's data"
                                    (click)="openEntriesModal(entry.entries)">
                                 </i>
                                  </td>
                                  
                                  
                                  <td>{{ entry.isStatusVerifyed }}</td>
                                  
                                  <td>
                                    <button *ngIf="entry?.status == ''" class="btn btn-success btn-sm" (click)="openApprovalDialog(entry, 'approve')">Approve</button>
                                    <button *ngIf="entry?.status == ''" class="btn btn-danger btn-sm" (click)="openApprovalDialog(entry, 'reject')">Reject</button>
                                  </td>
                                  
                                  
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                  
                </section>
                
              </cdk-step>
  
              <cdk-step [optional]="true"  >
                <ng-template cdkStepLabel>
                  <span class="number">2.</span>
                  <span>Present</span>
                </ng-template>
                <section>
                 
                </section>
              </cdk-step>
            </ng-stepper>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template #approvalModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">
        {{ selectedAction === 'approve' ? 'Approve Reason' : 'Reject Reason' }}
      </h5>
      <button type="button" class="close" (click)="modal.dismiss()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="approvalForm">
        <div class="form-group">
          <label for="approvalRemark">
            {{ selectedAction === 'approve' ? 'Reason ' : 'Reason (required)' }}
          </label>
          <textarea 
            id="approvalRemark"
            class="form-control" 
            formControlName="remark"
            rows="3"
            placeholder="Enter {{ selectedAction === 'approve' ? 'Reason' : 'reason' }}">
          </textarea>
          <small class="text-danger" *ngIf="approvalForm.get('remark')?.invalid && approvalForm.get('remark')?.touched">
            Reason is required for rejection
          </small>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btnSubmit btn-md btn-raised" 
        [class.btn-primary]="selectedAction === 'approve'"
        [class.btn-danger]="selectedAction === 'reject'"
        (click)="submitApproval()"
        [disabled]="selectedAction === 'reject' && approvalForm.invalid" style="
        background-color: green;
    ">
        Submit
      </button>
      <button type="button" class="btn btnCancel btn-md btn-raised"style="background-color: red;" (click)="modal.dismiss()">Cancel</button>

    </div>
  </ng-template>
  
