"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[411],{7411:(z,_,p)=>{p.r(_),p.d(_,{OperationModule:()=>J});var y=p(177),b=p(803),j=p(8032),k=p.n(j),D=p(2510),m=p(9417),e=p(4438),E=p(7114),M=p(5794),F=p(6554),v=p(7695);const N=["taskModal"],C=(a,h)=>({"task-entered":a,"has-hours":h}),I=a=>({"task-entered":a});function O(a,h){1&a&&(e.j41(0,"div",26),e.EFF(1," Employee Id is required. "),e.k0s())}function S(a,h){1&a&&(e.j41(0,"div",26),e.EFF(1," Employee Name is required. "),e.k0s())}function w(a,h){if(1&a&&(e.j41(0,"option",27),e.EFF(1),e.k0s()),2&a){const t=h.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function x(a,h){if(1&a&&(e.j41(0,"option",27),e.EFF(1),e.k0s()),2&a){const t=h.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function G(a,h){if(1&a){const t=e.RV6();e.j41(0,"li",28)(1,"a",29),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.selectWeek(s.number))}),e.EFF(2),e.k0s()()}if(2&a){const t=h.$implicit,n=e.XpG();e.R7$(),e.AVh("active",t.number===n.selectedWeek),e.R7$(),e.SpI(" ",t.label," ")}}function R(a,h){if(1&a&&(e.j41(0,"th",35),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.k0s()),2&a){const t=h.$implicit;e.R7$(),e.SpI(" ",t.day,""),e.R7$(2),e.SpI("",t.date," ")}}function P(a,h){if(1&a){const t=e.RV6();e.j41(0,"div",40),e.bIt("dblclick",function(){e.eBV(t);const s=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.onDoubleClick(s,i.enteredHours))}),e.EFF(1),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.Y8G("ngClass",e.l_i(2,C,n.taskArray[n.formatDateKey(t.fullDate)],n.enteredHours[n.formatDateKey(t.fullDate)])),e.R7$(),e.SpI(" ",n.enteredHours[n.formatDateKey(t.fullDate)]||"-"," ")}}function A(a,h){if(1&a){const t=e.RV6();e.j41(0,"input",41),e.bIt("ngModelChange",function(s){e.eBV(t);const i=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.onHourChange(s,i))})("keydown",function(s){e.eBV(t);const i=e.XpG(3);return e.Njj(i.blockNegative(s))})("blur",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.rowData())}),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(2,I,n.taskArray[n.formatDateKey(t.fullDate)]))("ngModel",n.enteredHours[n.formatDateKey(t.fullDate)])}}function Y(a,h){if(1&a){const t=e.RV6();e.j41(0,"i",42),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.onDoubleClick(s,i.enteredHours))}),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.Y8G("ngClass",n.taskArray[n.formatDateKey(t.fullDate)]?"fa-edit":"fa-plus")}}function W(a,h){if(1&a&&(e.j41(0,"td"),e.DNE(1,P,2,5,"div",36),e.j41(2,"div",37),e.DNE(3,A,1,4,"input",38)(4,Y,1,1,"i",39),e.k0s()()),2&a){const t=h.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngIf",!n.isEditMode),e.R7$(2),e.Y8G("ngIf",n.isEditMode&&t.date),e.R7$(),e.Y8G("ngIf",n.enteredHours[n.formatDateKey(t.fullDate)])}}function V(a,h){if(1&a&&(e.j41(0,"tr")(1,"td",30)(2,"div",31)(3,"table",32)(4,"thead")(5,"tr"),e.DNE(6,R,4,2,"th",33),e.k0s()(),e.j41(7,"tbody")(8,"tr"),e.DNE(9,W,5,3,"td",34),e.k0s()()()()()()),2&a){const t=e.XpG();e.R7$(6),e.Y8G("ngForOf",t.weekDates),e.R7$(3),e.Y8G("ngForOf",t.weekDates)}}function B(a,h){if(1&a){const t=e.RV6();e.j41(0,"button",43),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.submit())}),e.EFF(1," Save "),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("disabled",t.disableSaveUpdate)}}function $(a,h){if(1&a){const t=e.RV6();e.j41(0,"button",43),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.Update())}),e.EFF(1," Update "),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("disabled",t.disableSaveUpdate)}}function X(a,h){1&a&&(e.j41(0,"div",62),e.EFF(1," Project is required. "),e.k0s())}function H(a,h){1&a&&(e.j41(0,"div",62),e.EFF(1," Status is required. "),e.k0s())}function U(a,h){1&a&&(e.j41(0,"div",62),e.EFF(1," Task is required. "),e.k0s())}function K(a,h){if(1&a){const t=e.RV6();e.j41(0,"div",44)(1,"h4",45),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"button",46),e.bIt("click",function(){const s=e.eBV(t).$implicit;return e.Njj(s.dismiss("Cross click"))}),e.k0s()(),e.j41(5,"div",47)(6,"div",48)(7,"label",49),e.EFF(8,"Project Name"),e.k0s(),e.j41(9,"ng-select",50),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.DH7(i.selectedProjectPerTask,s)||(i.selectedProjectPerTask=s),e.Njj(s)}),e.bIt("change",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.onProjectSelectChange())}),e.k0s(),e.DNE(10,X,2,0,"div",51),e.k0s(),e.j41(11,"div",48)(12,"label",52),e.EFF(13,"Reporting To"),e.k0s(),e.j41(14,"input",53),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.DH7(i.reportingTo,s)||(i.reportingTo=s),e.Njj(s)}),e.k0s()(),e.j41(15,"div",48)(16,"label"),e.EFF(17,"Status"),e.j41(18,"span",26),e.EFF(19,"*"),e.k0s()(),e.j41(20,"select",54),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.DH7(i.status,s)||(i.status=s),e.Njj(s)}),e.j41(21,"option",55),e.EFF(22,"Select Status"),e.k0s(),e.j41(23,"option",56),e.EFF(24,"Open"),e.k0s(),e.j41(25,"option",57),e.EFF(26,"Close"),e.k0s()(),e.DNE(27,H,2,0,"div",51),e.k0s(),e.j41(28,"div",48)(29,"label"),e.EFF(30,"Task Description"),e.k0s(),e.j41(31,"textarea",58),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.DH7(i.taskText,s)||(i.taskText=s),e.Njj(s)}),e.bIt("ngModelChange",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.onTaskTextChange())}),e.EFF(32,"        "),e.k0s(),e.DNE(33,U,2,0,"div",51),e.k0s()(),e.j41(34,"div",59)(35,"button",60),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.saveTask())}),e.EFF(36,"Add"),e.k0s(),e.j41(37,"button",61),e.bIt("click",function(){const s=e.eBV(t).$implicit;return e.Njj(s.dismiss("cancel"))}),e.EFF(38,"Cancel"),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(2),e.SpI(" Enter Task for ",e.i5U(3,16,t.selectedDay.fullDate,"fullDate")," "),e.R7$(7),e.Y8G("items",t.filteredProjectList),e.R50("ngModel",t.selectedProjectPerTask),e.Y8G("multiple",!1)("searchable",!0)("disabled",!t.isEditMode),e.R7$(),e.Y8G("ngIf",t.projectValidationError),e.R7$(4),e.R50("ngModel",t.reportingTo),e.Y8G("disabled",t.readOnlyReportTo),e.R7$(6),e.R50("ngModel",t.status),e.Y8G("disabled",!t.isEditMode),e.R7$(7),e.Y8G("ngIf",t.submit&&!t.status),e.R7$(4),e.R50("ngModel",t.taskText),e.Y8G("readonly",!t.isEditMode),e.R7$(2),e.Y8G("ngIf",t.taskValidationError),e.R7$(2),e.Y8G("disabled",!t.isEditMode)}}let T=(()=>{class a{constructor(t,n,s,i,r){this.service=t,this.toastr=n,this.spinner=s,this.modalService=i,this.fb=r,this.reportingManagement=[],this.reportingTo="",this.reportingassignedEmployeeIDs=[],this.currentUserReportingData=[],this.isLoading=!1,this.submited=!1,this.employeeId="",this.employeeName="",this.projectName="",this.isEditMode=!0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.years=[],this.selectedMonth="",this.selectedYear=0,this.enteredHours={},this.weeks=[{number:1,label:"W1"},{number:2,label:"W2"},{number:3,label:"W3"},{number:4,label:"W4"}],this.weekDates=[],this.showModal=!1,this.status="",this.selectedDay={fullDate:new Date},this.taskText="",this.taskAssignments=[],this.taskassignedEmployeeIDs=[],this.taskArray={},this.selectedProjectPerTask="",this.projectArray={},this.taskValidationError=!1,this.projectValidationError=!1,this.filteredProjectList=[],this.canSave=!1,this.canUpdate=!1,this.canFinalSubmit=!1,this.disableSaveUpdate=!1,this.isFutureWeek=!1,this.isCurrentOrPastWeek=!0,this.tasksByDate={};const o=(new Date).getFullYear();for(let l=o-5;l<=o+5;l++)this.years.push(l);this.loginData=this.service.getLoginResponse(),console.log("this.loginData",this.loginData)}ngOnInit(){this.loginData=this.service.getLoginResponse(),console.log("this.loginData",this.loginData),this.timeSheetForm=this.fb.group({employeeId:["",m.k0.required],employeeName:["",m.k0.required],reportingTo:[""],status:[""]}),this.loginData&&this.loginData.data&&this.timeSheetForm.patchValue({employeeId:this.loginData.data.employeeID,employeeName:this.loginData.data.employeeFirstName});const t=new Date;this.selectedMonth=this.months[t.getMonth()],this.selectedYear=t.getFullYear(),this.getAllAssignments(),this.getAllreportingmapping(),this.getAlltaskAssignments(),setInterval(()=>{},6e4)}getAllAssignments(){this.spinner.show(),this.filteredUserProjects=[],this.selectedEmployee=null,this.service.getAllAssignments().subscribe(t=>{this.allAssignment=t.data,console.log("this.allAssignment",this.allAssignment,this.loginData.data),this.filteredProjectList=[],this.loginData&&this.loginData.data&&(this.filteredProjectList=this.allAssignment.filter(n=>n.employeeID===this.loginData.data.employeeID),console.log("filteredProjectList",this.filteredProjectList)),console.log("filtered projects",this.filteredProjectList),this.spinner.hide(),this.generateWeeks(),this.updateWeekDates()},t=>{console.error("Error fetching assignments:",t),this.spinner.hide()})}get f(){return this.timeSheetForm.controls}onEmployeeChange(){this.projectName=null,console.log("Selected Employee:",this.selectedEmployee),this.projectName=this.timeSheetForm.value.selectedEmployee&&"object"==typeof this.timeSheetForm.value.selectedEmployee&&"projectName"in this.timeSheetForm.value.selectedEmployee?this.timeSheetForm.value.selectedEmployee.projectName:this.timeSheetForm.value.selectedEmployee,console.log("projectName",this.projectName)}generateWeeks(){this.weeks=[];const t=this.months.indexOf(this.selectedMonth),n=this.selectedYear,i=new Date(n,t,1).getDay(),o=new Date(n,t,1+(0===i?-6:1-i));let l=new Date(o),c=1;for(;l.getMonth()<=t&&(this.weeks.push({number:c,label:`W${c}`}),c++,l.setDate(l.getDate()+7),!(l.getMonth()>t)););const d=new Date;this.selectedWeek=d.getFullYear()===n&&d.getMonth()===t?this.getWeekNumber(d,o):1,this.updateWeekDates()}updateWeekDates(){this.weekDates=[];const t=this.months.indexOf(this.selectedMonth),n=this.selectedYear,i=new Date(n,t,1).getDay(),o=new Date(n,t,1+(0===i?-6:1-i)),l=new Date(o);l.setDate(l.getDate()+7*(this.selectedWeek-1));for(let c=0;c<7;c++){const d=new Date(l);d.setDate(l.getDate()+c),d.getMonth()===t?this.weekDates.push({day:this.getDayName(d.getDay()),date:d.getDate(),fullDate:d}):this.weekDates.push({day:this.getDayName(d.getDay()),date:"",fullDate:null})}this.onCombinatinnSaved()}getDayName(t){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t]}onMonthYearChange(){this.isEditMode=!1,this.generateWeeks(),this.updateWeekDates()}selectWeek(t){this.selectedWeek=t,this.updateWeekDates(),this.isEditMode=!1}rowData(){console.log("weekDates",this.weekDates,this.enteredHours)}getYear(t){return t instanceof Date&&!isNaN(t.getTime())?t.getFullYear():(console.error("Invalid date passed to getYear:",t),0)}getMonthName(t){return t instanceof Date&&!isNaN(t.getTime())?t.toLocaleString("default",{month:"long"}):(console.error("Invalid date passed to getMonthName:",t),"")}formatDateKey(t){const n=new Date(t);return`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`}getWeekNumber(t,n){const s=Math.floor((t.getTime()-n.getTime())/864e5);return s<0?1:Math.floor(s/7)+1}getWeekDates(t,n,s){const r=new Date(n,t,1).getDay();let l=new Date(n,t,1+(0===r?1:8-r)-1);const c=new Date(l);c.setDate(l.getDate()+7*(s-1));const d=[];for(let u=0;u<7;u++){const g=new Date(c);g.setDate(c.getDate()+u),d.push(g)}return d}openTaskModal(t){this.selectedDay=t,this.getAllreportingmapping();const n=this.formatDateKey(t.date);this.selectedDay.fullDate=n,this.selectedDay.task=this.tasksByDate[n]||"",this.showModal=!0}closeModal(){this.showModal=!1,this.selectedDay=null}onDoubleClick(t,n){const s=this.formatDateKey(t.fullDate),i=n[s];if(i&&!isNaN(Number(i))){if(this.selectedDay=t,this.taskText="",this.selectedProjectPerTask=null,this.status="",this.reportingTo="",this.savedWeekData?.entries){const r=this.savedWeekData.entries.find(o=>this.formatDateKey(o.date)===s);r&&(this.taskText=r.task||"",this.status=r.status||"",r.project&&(this.selectedProjectPerTask=this.filteredProjectList.find(o=>o.projectName===r.project)||r.project))}if(!this.taskText&&this.taskArray[s]&&(this.taskText=this.taskArray[s]),!this.taskText){const r=this.taskAssignments.find(o=>o.employeeID===this.loginData?.data?.employeeID&&this.formatDateKey(o.TaskDate)===s);console.log("taskAssignment",r),r&&(this.taskText=r.description||"",this.status=r.status||"",this.reportingTo=r.reportingTo||"",!this.selectedProjectPerTask&&r.projectName&&(this.selectedProjectPerTask=this.filteredProjectList.find(o=>o.projectName===r.projectName)||r.projectName))}this.getAllreportingmapping(),setTimeout(()=>{this.modalService.open(this.taskModal,{centered:!0})},0)}else console.log(`No hours entered for ${s}, popup will not open.`)}onTaskTextChange(){this.taskText&&""!==this.taskText.trim()&&(this.taskValidationError=!1)}onProjectSelectChange(){this.selectedProjectPerTask&&(this.projectValidationError=!1)}saveTask(){const t=this.formatDateKey(this.selectedDay.fullDate),n=this.taskText?.trim(),s=this.selectedProjectPerTask;this.taskValidationError=!1,this.projectValidationError=!1,n||(this.taskValidationError=!0),s||(this.projectValidationError=!0),!this.taskValidationError&&!this.projectValidationError&&(this.taskArray[t]=n,this.projectArray[t]=s,this.modalService.dismissAll())}blockNegative(t){("-"===t.key||"e"===t.key)&&t.preventDefault()}onHourChange(t,n){const s=this.formatDateKey(n.fullDate),i=Number(t);this.enteredHours[s]=isNaN(i)||i<0||i>24?null:i}getStartDateOfWeek(t,n){const s=new Date(n,0,1),i=s.getDay(),r=i<=4?i-1:i-8,o=new Date(s);o.setDate(s.getDate()-r);const l=new Date(o);return l.setDate(o.getDate()+7*(t-1)),l}preparePayload(){let t=0;const n=this.weekDates.filter(o=>o.fullDate&&!isNaN(new Date(o.fullDate).getTime())).map(o=>{const l=this.formatDateKey(o.fullDate),c=this.enteredHours[l];"number"==typeof c&&!isNaN(c)&&(t+=c);let d="";return this.projectArray[l]&&(d="object"==typeof this.projectArray[l]?this.projectArray[l].projectName:this.projectArray[l]),{date:l,day:o.day,hours:c??"",task:this.taskArray[l]??"",project:d,reportingTo:this.reportingTo,status:this.status}}),s=this.weekDates.find(o=>o.fullDate),i=new Date(s?.fullDate),r={employeeId:this.timeSheetForm.value.employeeId,projectName:this.timeSheetForm.value.projectName,month:this.getMonthName(i),year:i.getFullYear(),weekNumber:this.selectedWeek,weekHoursTotal:t,entries:n,saveDecision:!0,finalDecision:!1,status:this.timeSheetForm.value.status,employeeName:this.timeSheetForm.value.employeeName,decisionTakenByUser:"",isStatusVerifyed:"",isVerifyedreason:"",loggedInUser:"",reason:"",GlobalReportingTeamleadId:this.GlobalReportingTeamleadId,GlobalReportingTeamleadName:this.GlobalReportingTeamleadName};return console.log("Final Payload: ",r),r}finalPayload(){let t=0;const n=this.weekDates.filter(o=>o.fullDate&&!isNaN(new Date(o.fullDate).getTime())).map(o=>{const l=this.formatDateKey(o.fullDate),c=this.enteredHours[l];return"number"==typeof c&&!isNaN(c)&&(t+=c),{date:l,day:o.day,hours:c??"",task:this.taskArray[l]??"",project:this.projectArray[l]?.projectName||"",reportingTo:this.reportingTo,status:this.status}}),s=this.weekDates.find(o=>o.fullDate),i=new Date(s?.fullDate),r={timeSheetUniqueId:this.savedUniqueId,employeeId:this.timeSheetForm.value.employeeId,projectName:this.timeSheetForm.value.projectName,month:this.getMonthName(i),year:i.getFullYear(),weekNumber:this.selectedWeek,weekHoursTotal:t,entries:n,saveDecision:!1,finalDecision:!0,status:this.timeSheetForm.value.status,employeeName:this.timeSheetForm.value.employeeName,decisionTakenByUser:"",isStatusVerifyed:"",isVerifyedreason:"",loggedInUser:"",reason:"",GlobalReportingTeamleadId:this.GlobalReportingTeamleadId,GlobalReportingTeamleadName:this.GlobalReportingTeamleadName};return console.log("Final Payload: ",r),r}updatePayload(){let t=0;const n=this.weekDates.filter(o=>o.fullDate&&!isNaN(new Date(o.fullDate).getTime())).map(o=>{const l=this.formatDateKey(o.fullDate),c=this.enteredHours[l];return"number"==typeof c&&!isNaN(c)&&(t+=c),{date:l,day:o.day,hours:c??"",task:this.taskArray[l]??"",project:this.projectArray[l]?.projectName||"",reportingTo:this.reportingTo,status:this.status}}),s=this.weekDates.find(o=>o.fullDate),i=new Date(s?.fullDate),r={timeSheetUniqueId:this.savedUniqueId,employeeId:this.timeSheetForm.value.employeeId,projectName:this.timeSheetForm.value.projectName,month:this.getMonthName(i),year:i.getFullYear(),weekNumber:this.selectedWeek,weekHoursTotal:t,entries:n,saveDecision:!0,finalDecision:!1,status:this.timeSheetForm.value.status,employeeName:this.timeSheetForm.value.employeeName,decisionTakenByUser:"",isStatusVerifyed:"",isVerifyedreason:"",loggedInUser:"",reason:"",GlobalReportingTeamleadId:this.GlobalReportingTeamleadId,GlobalReportingTeamleadName:this.GlobalReportingTeamleadName};return console.log("Final Payload: ",r),r}submit(){if(this.timeSheetForm.invalid)return void(this.submited=!0);const t=this.preparePayload();t.entries.every(s=>""===s.hours||null==s.hours)?k().fire({icon:"warning",title:"No Data Entered",text:"Please enter hours for at least one day before submitting."}):(console.log("Final Payload: ",t),this.spinner.show(),this.service.TimeEntrySave(t).subscribe(s=>{console.log("submit",s),console.log("apiErr",s,s.responseData),this.spinner.hide(),400==s.status?this.toastr.success(s.message):(this.savedUniqueId=s.timeSheetUniqueId,this.onCombinatinnSaved(),this.isEditMode=!1,k().fire({title:"",text:s.message,icon:"success",cancelButtonText:"Ok",timer:5e3}).then(i=>{}))},s=>{this.toastr.error(s),console.log("error",s),this.spinner.hide()}))}Update(){if(this.timeSheetForm.invalid)return void(this.submited=!0);const t=this.updatePayload();t.entries.every(s=>""===s.hours||null==s.hours)?k().fire({icon:"warning",title:"No Data Entered",text:"Please enter hours for at least one day before submitting."}):(console.log("Final Payload: ",t),this.spinner.show(),this.service.updateTimeSheet(t).subscribe(s=>{console.log("submit",s),console.log("apiErr",s,s.responseData),this.spinner.hide(),400==s.status?this.toastr.success(s.message):(this.isEditMode=!1,k().fire({title:"",text:s.message,icon:"success",cancelButtonText:"Ok",timer:5e3}).then(i=>{}))},s=>{this.toastr.error(s),console.log("error",s),this.spinner.hide()}))}FinalSubmit(){if(this.timeSheetForm.invalid)return void(this.submited=!0);const t=this.finalPayload();t.entries.every(s=>""===s.hours||null==s.hours)?k().fire({icon:"warning",title:"No Data Entered",text:"Please enter hours for at least one day before submitting."}):(console.log("Final Payload: ",t),this.spinner.show(),this.service.updateTimeSheet(t).subscribe(s=>{console.log("submit",s),console.log("apiErr",s,s.responseData),this.spinner.hide(),400==s.status?this.toastr.success(s.message):(this.getAllAssignments(),this.isEditMode=!1,k().fire({title:"",text:s.message,icon:"success",cancelButtonText:"Ok",timer:5e3}).then(i=>{}))},s=>{this.toastr.error(s),console.log("error",s),this.spinner.hide()}))}onEditWeek(){this.isEditMode=!0}onCombinatinnSaved(){this.isEditMode=!1;const t={employeeId:this.timeSheetForm.value.employeeId,month:this.selectedMonth,year:this.selectedYear,weekNumber:this.selectedWeek};this.isSavedOrNot=null,this.savedUniqueId=null,this.finalButtonDisable=null,this.updateButtonDisable=null,this.GlobalReportingTeamleadId=null,this.GlobalReportingTeamleadName=null,this.service.timeSheetList(t).subscribe(n=>{if(console.log("submit",n),this.isSavedOrNot=n.isSaved,this.savedUniqueId=n.data?.timeSheetUniqueId,this.finalButtonDisable=n.data?.finalDecision,this.updateButtonDisable=n.data?.saveDecision,this.GlobalReportingTeamleadId=n.data?.GlobalReportingTeamleadId,this.GlobalReportingTeamleadName=n.data?.GlobalReportingTeamleadName,this.spinner.hide(),400===n.status)this.toastr.success(n.message);else{if(this.savedWeekData=n.data,this.enteredHours={},this.taskArray={},this.projectArray={},this.savedWeekData?.entries?.length&&this.savedWeekData.entries.forEach(c=>{const d=this.formatDateKey(c.date);if(c.hours&&(this.enteredHours[d]=c.hours),c.task&&(this.taskArray[d]=c.task),c.project){const u=this.filteredProjectList.find(g=>g.projectName===c.project);this.projectArray[d]=u||c.project}}),!0===this.finalButtonDisable)return this.disableSaveUpdate=!0,void(this.canFinalSubmit=!1);const s=new Date,i=s.getHours(),r=this.weekDates.filter(c=>["Monday","Tuesday","Wednesday","Thursday","Friday"].includes(c.day)),o=r.length?r[r.length-1].fullDate:null,l=o&&s.toDateString()===new Date(o).toDateString()&&i>=18;this.canFinalSubmit=l&&this.updateButtonDisable,this.disableSaveUpdate=!1}},n=>{this.toastr.error("Failed to fetch timesheet"),this.spinner.hide()})}checkFinalSubmitEligibility(){const t=this.selectedWeek,n=this.selectedYear,s=Number(this.selectedMonth)-1,i=new Date(n,s,1);let r=0;const o=[];for(let f=new Date(i);f.getMonth()===s;f.setDate(f.getDate()+1))1===f.getDay()&&r++,r===t&&o.push(new Date(f));const l=o.filter(f=>f.getDay()>=1&&f.getDay()<=5);if(0===l.length)return void(this.finalButtonDisable=!0);const c=l[l.length-1],d=new Date,u=d.getDate()===c.getDate()&&d.getMonth()===c.getMonth()&&d.getFullYear()===c.getFullYear(),g=d.getHours()>=18;this.finalButtonDisable=!(u&&g)}checkIfFinalSubmitShouldEnable_Friday6pm(){const t=new Date,n=t.getDay(),s=t.getHours(),i=t.getMonth(),r=this.months.indexOf(this.selectedMonth),o=Math.ceil(t.getDate()/7),l=t.getFullYear()===this.selectedYear&&r===i,c=this.selectedWeek===o,d=5===n,u=s>=18;console.log("isSameMonth",l,"isSameWeek",c,"isFriday",d,"isAfter6PM",u),this.finalButtonDisable=!(l&&c&&d&&u),console.log("this.finalButtonDisable",this.finalButtonDisable)}checkIfFinalSubmitShouldEnable_testing(){const t=new Date,n=t.getDay(),s=t.getHours(),i=t.getMonth(),r=this.months.indexOf(this.selectedMonth),o=Math.ceil(t.getDate()/7),l=t.getFullYear()===this.selectedYear&&r===i,c=this.selectedWeek===o,d=5===n,u=s>=18,g=3===n&&s>=12;console.log("isSameMonth",l,"isSameWeek",c,"isFriday",d,"isAfter6PM",u,"isWednesdayTest",g),this.finalButtonDisable=!(l&&c&&(d&&u||g)),console.log("this.finalButtonDisable",this.finalButtonDisable)}getAllreportingmapping(){this.isLoading=!0,this.spinner.show(),this.GlobalReportingTeamleadId=null,this.service.getAllreporting().subscribe({next:t=>{if(t?.data&&Array.isArray(t.data)){this.reportingManagement=t.data,this.reportingassignedEmployeeIDs=this.reportingManagement.map(s=>s.employeeID);const n=this.reportingManagement.find(s=>s.TeamMemberId===this.loginData?.data?.employeeID);console.log("Matched reporting entry:",n),this.GlobalReportingTeamleadId=n.TeamId,this.GlobalReportingTeamleadName=n.TeamLead,this.reportingTo=n&&n.TeamLead||"",this.readOnlyReportTo=!!this.reportingTo,console.log("this.readOnlyReportTo",this.readOnlyReportTo)}else this.reportingManagement=[];this.isLoading=!1,this.spinner.hide()},error:t=>{console.error("Error fetching reporting data",t),this.isLoading=!1,this.spinner.hide()}})}getAlltaskAssignments(){this.spinner.show(),this.service.getAllTaskAssignments().subscribe(t=>{this.taskAssignments=t.data||[],console.log("getAlltaskAssignments",this.taskAssignments),this.spinner.hide()},t=>{this.spinner.hide(),console.log("Assignment error",t)})}selectTask(t){const n=this.taskAssignments.find(s=>s.id===t);n&&(this.selectedProjectPerTask=n.projectName,this.status=n.status,this.taskText=n.taskDescription,this.reportingTo=n.reportingTo||"")}getCurrentWeekNumber(t){const n=new Date(t.getFullYear(),0,1),s=Math.floor((t.getTime()-n.getTime())/864e5);return Math.ceil((s+n.getDay()+1)/7)}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(E.t),e.rXU(M.tw),e.rXU(F.ex),e.rXU(v.Bq),e.rXU(m.ok))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-operation-time-entry"]],viewQuery:function(n,s){if(1&n&&e.GBs(N,5),2&n){let i;e.mGM(i=e.lsd())&&(s.taskModal=i.first)}},standalone:!0,features:[e.aNF],decls:51,vars:12,consts:[["taskModal",""],[1,"card"],[1,"card-header","text-center"],[1,"card-body"],[3,"formGroup"],[1,"row"],[1,"col-md-4"],[1,"form-group"],["for","employeeId"],["type","text","id","employeeId","formControlName","employeeId","readonly","",1,"form-control"],["class","text-danger",4,"ngIf"],["for","employeeName"],["type","text","id","employeeName","formControlName","employeeName","readonly","",1,"form-control"],[1,"table","table-bordered","text-center"],["id","monthSelect",1,"form-control",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],["id","yearSelect",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"nav","nav-tabs"],["class","nav-item",4,"ngFor","ngForOf"],[1,"d-flex"],[1,"btn","btnEdit","btn-raised","btn-md",3,"click"],[4,"ngIf"],[1,"text-end","p-3"],["type","button","class","btn btnSave btn-raised btn-md mr-1",3,"disabled","click",4,"ngIf"],["type","button",1,"btn","btnFinalSubmit","btn-raised","btn-md",3,"click","disabled"],[1,"text-danger"],[3,"value"],[1,"nav-item"],[1,"nav-link","week-tab",3,"click"],["colspan","3"],[1,"table-responsive"],[1,"table","table-bordered","mb-0"],["class","text-center",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"text-center"],[3,"ngClass","dblclick",4,"ngIf"],[1,"position-relative"],["type","number","min","0","max","24","class","form-control mt-1 pr-4","placeholder","Hours",3,"ngClass","ngModel","ngModelChange","keydown","blur",4,"ngIf"],["class","fa","style","position: absolute; right: 10px; top: 12px; cursor: pointer;",3,"ngClass","click",4,"ngIf"],[3,"dblclick","ngClass"],["type","number","min","0","max","24","placeholder","Hours",1,"form-control","mt-1","pr-4",3,"ngModelChange","keydown","blur","ngClass","ngModel"],[1,"fa",2,"position","absolute","right","10px","top","12px","cursor","pointer",3,"click","ngClass"],["type","button",1,"btn","btnSave","btn-raised","btn-md","mr-1",3,"click","disabled"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-group","mb-3"],["for","projectName"],["bindLabel","projectName","placeholder","Select Project",3,"ngModelChange","change","items","ngModel","multiple","searchable","disabled"],["class","text-danger mt-1",4,"ngIf"],["for","reportingTo"],["type","text",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"form-control",3,"ngModelChange","ngModel","disabled"],["value",""],["value","Open"],["value","Close"],["rows","4","placeholder","Enter task here...",1,"form-control",3,"ngModelChange","ngModel","readonly"],[1,"modal-footer"],[1,"btn","btnSave","btn-raised","btn-md",3,"click","disabled"],[1,"btn","btnClose","btn-raised","btn-md",3,"click"],[1,"text-danger","mt-1"]],template:function(n,s){if(1&n){const i=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h5"),e.EFF(3,"Time Entry"),e.k0s()(),e.j41(4,"div",3)(5,"form",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),e.EFF(10,"Employee ID"),e.k0s(),e.nrm(11,"input",9),e.k0s(),e.DNE(12,O,2,0,"div",10),e.k0s(),e.j41(13,"div",6)(14,"div",7)(15,"label",11),e.EFF(16,"Employee Name"),e.k0s(),e.nrm(17,"input",12),e.k0s(),e.DNE(18,S,2,0,"div",10),e.k0s()()()(),e.j41(19,"table",13)(20,"thead")(21,"tr")(22,"th"),e.EFF(23,"Month"),e.k0s(),e.j41(24,"th"),e.EFF(25,"Year"),e.k0s(),e.j41(26,"th"),e.EFF(27,"Weeks"),e.k0s()()(),e.j41(28,"tbody")(29,"tr")(30,"td")(31,"select",14),e.mxI("ngModelChange",function(o){return e.eBV(i),e.DH7(s.selectedMonth,o)||(s.selectedMonth=o),e.Njj(o)}),e.bIt("change",function(){return e.eBV(i),e.Njj(s.onMonthYearChange())}),e.DNE(32,w,2,2,"option",15),e.k0s()(),e.j41(33,"td")(34,"select",16),e.mxI("ngModelChange",function(o){return e.eBV(i),e.DH7(s.selectedYear,o)||(s.selectedYear=o),e.Njj(o)}),e.bIt("change",function(){return e.eBV(i),e.Njj(s.onMonthYearChange())}),e.DNE(35,x,2,2,"option",15),e.k0s()(),e.j41(36,"td")(37,"div",17)(38,"ul",18),e.DNE(39,G,3,3,"li",19),e.k0s(),e.j41(40,"div",20)(41,"button",21),e.bIt("click",function(){return e.eBV(i),e.Njj(s.onEditWeek())}),e.EFF(42," Edit "),e.k0s()()()()(),e.DNE(43,V,10,2,"tr",22),e.k0s()(),e.j41(44,"div",23),e.DNE(45,B,2,1,"button",24)(46,$,2,1,"button",24),e.j41(47,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(s.FinalSubmit())}),e.EFF(48," Final Submit "),e.k0s()()(),e.DNE(49,K,39,19,"ng-template",null,0,e.C5r)}2&n&&(e.R7$(5),e.Y8G("formGroup",s.timeSheetForm),e.R7$(7),e.Y8G("ngIf",s.submited&&s.f.employeeId.errors),e.R7$(6),e.Y8G("ngIf",s.submited&&s.f.employeeName.errors),e.R7$(13),e.R50("ngModel",s.selectedMonth),e.R7$(),e.Y8G("ngForOf",s.months),e.R7$(2),e.R50("ngModel",s.selectedYear),e.R7$(),e.Y8G("ngForOf",s.years),e.R7$(4),e.Y8G("ngForOf",s.weeks),e.R7$(4),e.Y8G("ngIf",s.weekDates&&s.weekDates.length),e.R7$(2),e.Y8G("ngIf",!s.isSavedOrNot),e.R7$(),e.Y8G("ngIf",s.isSavedOrNot),e.R7$(),e.Y8G("disabled",!s.canFinalSubmit))},dependencies:[m.YN,m.qT,m.xH,m.y7,m.me,m.Q0,m.wz,m.BC,m.cb,m.VZ,m.zX,m.vS,y.MD,y.YU,y.Sq,y.bT,y.vh,D.MQ,D.vr,m.X1,m.j4,m.JD],styles:[".week-tabs[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.week-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{cursor:pointer;color:#495057}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle;text-align:center}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem}.week-tab[_ngcontent-%COMP%]{cursor:pointer;padding:5px 10px;margin:0 2px;font-size:16px;font-weight:700;min-width:100px;text-align:center;border-radius:8px;transition:all .3s}.nav-item[_ngcontent-%COMP%]{width:20%!important}.week-tab[_ngcontent-%COMP%]:hover{border:5px solid!important;border-image:linear-gradient(135deg,#0cc685,#0736c5) 1!important}.week-tab.active[_ngcontent-%COMP%]{border:3px solid!important;border-image:linear-gradient(135deg,#0cc685,#0736c5) 1!important;background-image:linear-gradient(to right,#82c4fa,#0072cf)!important}.task-entered[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;background-color:#e8f5e9;font-weight:700;font-size:15px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}"]})}return a})();const L=[{path:"",component:T},{path:"OperationTimeEntry",component:T}];let q=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.$C({type:a});static#s=this.\u0275inj=e.G2t({imports:[b.iI.forChild(L),b.iI]})}return a})(),J=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.$C({type:a});static#s=this.\u0275inj=e.G2t({imports:[y.MD,q]})}return a})()}}]);